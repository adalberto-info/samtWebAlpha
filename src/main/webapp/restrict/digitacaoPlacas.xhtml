<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                template="/WEB-INF/templates/LayoutMaster.xhtml">

    response.setHeader("Cache-Control", "no-cache, no-store, must-revalidate"); // HTTP 1.1.
    response.setHeader("Pragma", "no-cache"); // HTTP 1.0.
    response.setDateHeader("Expires", 0); // Proxies.

    <ui:define name="content">
        <style>
            .ui-growl{
                position:fixed;
                top:70px;
                right:5px;
                width:301px;
            }
        </style>
        <script>
            PrimeFaces.locales['pt'] = {
                closeText: 'Fechar',
                prevText: 'Anterior',
                nextText: 'Próximo',
                currentText: 'Começo',
                monthNames: ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'],
                monthNamesShort: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
                dayNames: ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'],
                dayNamesShort: ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'],
                dayNamesMin: ['D', 'S', 'T', 'Q', 'Q', 'S', 'S'],
                weekHeader: 'Semana',
                firstDay: 0,
                isRTL: false,
                showMonthAfterYear: false,
                yearSuffix: '',
                timeOnlyTitle: 'Só Horas',
                timeText: 'Tempo',
                hourText: 'Hora',
                minuteText: 'Minuto',
                secondText: 'Segundo',
                ampm: false,
                month: 'Mês',
                week: 'Semana',
                day: 'Dia',
                allDayText: 'Todo o Dia'
            };
        </script>
        
        <p:fieldset legend="Digitação de Placas">
            <br/>
            <h:form prependId="false" id="formDigitacaoPlacas">
                <p:growl id="msg0" />
<!--                                                     <p:focus id="focusToPlaca" for="dc_placa" /> -->

                <div class="ui-fluid">
                    <p:panelGrid columns="2" id="grid1">        
 
                        <p:panelGrid columns="1"  styleClass="ui-panelgrid-blank" id="grid0" >

                            <p:panelGrid columns="2" styleClass="ui-panelgrid-blank" columnClasses="ui-grid-col-12, ui-grid-col-18">
                                <p:outputLabel for="dc_nr_multa" value="Nr. multa: "/>
                                <p:inputText id="dc_nr_multa" size="25" maxlength="18" value="#{mbDigitacaoPlacas.autoInfracao.dc_nr_multa}" disabled="true"/>
                            </p:panelGrid>

                            <p:panelGrid columns="2"  styleClass="ui-panelgrid-blank" columnClasses="ui-grid-col-12">
                                <p:outputLabel for="dc_local" value="Local: "/>
                                <p:inputTextarea id="dc_local" value="#{mbDigitacaoPlacas.vpc_dc_local}" cols="91" disabled="true"/> 
                            </p:panelGrid>

                            <p:panelGrid columns="6" styleClass="ui-panelgrid-blank" columnClasses="ui-grid-col-12">
                                <p:outputLabel for="nr_faixa" value="Faixa: "/>
                                <p:inputText id="nr_faixa" size="2" maxlength="2" value="#{mbDigitacaoPlacas.autoInfracao.nr_faixa}" disabled="true"/>

                                <p:outputLabel for="dc_serieEquipamento" value="Equipamento:"/>
                                <p:inputText id="dc_serieEquipamento" size="15" maxlength="15" value="#{mbDigitacaoPlacas.autoInfracao.dc_serieEquipamento}" disabled="true"/>

                                <p:outputLabel for="dt_validadeLaudo" value="Dt. certificado: "/>
                                <p:inputText id="dt_validadeLaudo" value="#{mbDigitacaoPlacas.autoInfracao.dt_validadeLaudo}" disabled="true"/>

                            </p:panelGrid>

                            <p:panelGrid columns="2" styleClass="ui-panelgrid-blank">
                                <p:outputLabel for="nr_codEnquadramento" value="Enquadramento: "/>
                                <p:inputText id="nr_codEnquadramento" size="5" maxlength="5" value="#{mbDigitacaoPlacas.autoInfracao.nr_codEnquadramento}" disabled="true"/>
                            </p:panelGrid>

                            <p:panelGrid columns="1" styleClass="ui-panelgrid-blank">
                                <p:inputTextarea id="dc_enquadramento" value="#{mbDigitacaoPlacas.vpc_dc_enquadramento}" cols="85" disabled="true"/> 
                            </p:panelGrid>

                            <p:panelGrid columns="4" styleClass="ui-panelgrid-blank">
                                <p:outputLabel for="dt_infracao" value="Dt. Infração: "/>
                                <p:inputText id="dt_infracao" size="10" maxlength="10" value="#{mbDigitacaoPlacas.autoInfracao.dt_infracao}" disabled="true"/>

                                <p:outputLabel for="dc_hr_infracao" value="Hora Infração: "/>
                                <p:inputText id="dc_hr_infracao" size="8" maxlength="8" value="#{mbDigitacaoPlacas.autoInfracao.dc_hr_infracao}" disabled="true"/>

                            </p:panelGrid>

                            <p:panelGrid columns="6" styleClass="ui-panelgrid-blank">
                                <p:outputLabel for="nr_velocidadePermitida" value="Vel. Permit: "/>
                                <p:inputText id="nr_velocidadePermitida" size="3" maxlength="3" value="#{mbDigitacaoPlacas.autoInfracao.nr_velocidadePermitida}" disabled="true"/>

                                <p:outputLabel for="nr_velocidadeAferida" value="Vel. Aferida: "/>
                                <p:inputText id="nr_velocidadeAferida" size="3" maxlength="3" value="#{mbDigitacaoPlacas.autoInfracao.nr_velocidadeAferida}" disabled="true"/>

                                <p:outputLabel for="nr_velocidadeConsiderada" value="Vel. Consid.: "/>
                                <p:inputText id="nr_velocidadeConsiderada" size="3" maxlength="3" value="#{mbDigitacaoPlacas.autoInfracao.nr_velocidadeConsiderada}" disabled="true"/>
                            </p:panelGrid>

                            <p:panelGrid columns="2" styleClass="ui-panelgrid-blank" id="grid2">
                                <p:outputLabel for="dc_placa" value="Placa: "/>
                                <p:inputText id="dc_placa" size="7" maxlength="7" value="#{mbDigitacaoPlacas.autoInfracao.dc_placa}" onkeyup="this.value = this.value.toUpperCase()">
                                    <p:ajax event="blur" update="@form" listener="#{mbDigitacaoPlacas.consultaPlaca(mbDigitacaoPlacas.autoInfracao.dc_placa)}" />
                                </p:inputText>
                            </p:panelGrid>

                            <p:panelGrid columns="2" styleClass="ui-panelgrid-blank">
                                <p:outputLabel for="dc_mensagem" value="Mensagem: "/>
                                <p:inputTextarea id="dc_mensagem" value = "#{mbDigitacaoPlacas.vpc_dc_mensagem}" cols="85" disabled="true"/>
                            </p:panelGrid>

                            <p:panelGrid columns="2" styleClass="ui-panelgrid-blank">
                                <p:outputLabel for="dc_marca" value="Marca/Mod. Denatran: "/>
                                <p:inputText id="dc_marca" size="35" maxlength="35" value="#{mbDigitacaoPlacas.vpc_dc_marca}" disabled="true"/>
                            </p:panelGrid>

                            <p:panelGrid columns="4" styleClass="ui-panelgrid-blank">
                                <p:outputLabel for="dc_especie" value="Espécie: "/>
                                <p:inputText id="dc_especie" size="20" maxlength="20" value="#{mbDigitacaoPlacas.vpc_dc_especie}" disabled="true"/>
                                <p:outputLabel for="dc_categoria" value="Categoria: "/>
                                <p:inputText id="dc_categoria" size="35" maxlength="35" value="#{mbDigitacaoPlacas.vpc_dc_categoria}" disabled="true"/>
                            </p:panelGrid>
                            <p:panelGrid columns="4" styleClass="ui-panelgrid-blank">
                                <p:outputLabel for="dc_tipo" value="Tipo: "/>
                                <p:inputText id="dc_tipo" size="35" maxlength="35" value="#{mbDigitacaoPlacas.vpc_dc_tipo}" disabled="true"/>

                                <p:outputLabel for="dc_cor" value="Cor: "/>
                                <p:inputText id="dc_cor" size="20" maxlength="20" value="#{mbDigitacaoPlacas.vpc_dc_cor}" disabled="true"/>
                            </p:panelGrid>

                            <p:panelGrid columns="6" styleClass="ui-panelgrid-blank">
                                <p:outputLabel for="nr_anoModelo" value="Ano: "/>
                                <p:inputText id="nr_anoModelo" size="4" maxlength="4" value="#{mbDigitacaoPlacas.autoInfracao.nr_anoModelo}" disabled="true"/>

                                <p:outputLabel for="dc_codMunicipio" value="Município: "/>
                                <p:inputText id="dc_codMunicipio" size="40" maxlength="40" value="#{mbDigitacaoPlacas.vpc_dc_municipio}" disabled="true"/>

                                <p:outputLabel for="dc_uf" value="UF: "/>
                                <p:inputText id="dc_uf" size="2" maxlength="2" value="#{mbDigitacaoPlacas.autoInfracao.dc_uf}" disabled="true"/>
                            </p:panelGrid>

                            <p:panelGrid columns="2" styleClass="ui-panelgrid-blank">
                                <p:outputLabel for="nr_codMarcaCET" value="Marca CET: "/>
                                <p:selectOneMenu id="nr_codMarcaCET" value="#{mbDigitacaoPlacas.autoInfracao.nr_codMarcaCET}" style="width:250px" >
                                    <f:selectItem itemLabel="Selecione a marca CET" itemValue="" />
                                    <f:selectItems value="#{mbDigitacaoPlacas.veiculoMarcaCETs}" var="listaVeiculoMarcaCETs" 
                                                   itemLabel="#{listaVeiculoMarcaCETs.dc_marca}" itemValue="#{listaVeiculoMarcaCETs.nr_codigo}"/>

                                </p:selectOneMenu>
                            </p:panelGrid>

                            <p:panelGrid columns="2" styleClass="ui-panelgrid-blank">
                                <p:outputLabel for="nr_codInconsistencia" value="Motivo Invalidação: "/>
                                <p:selectOneMenu id="nr_codInconsistencia" value="#{mbDigitacaoPlacas.autoInfracao.nr_codInconsistencia}" style="width:550px"> 
                                    <f:selectItem itemLabel="Selecione o motivo inconsistência" itemValue="99" />
                                    <f:selectItem itemLabel="Imagem Válida" itemValue="00" />
                                    <f:selectItems value="#{mbDigitacaoPlacas.motivoInconsistenciaImagens}" var="listaMotivoInconsistenciaImagens" 
                                                   itemLabel="#{listaMotivoInconsistenciaImagens.dc_inconsistencia}" itemValue="#{listaMotivoInconsistenciaImagens.nr_codigo.toString()}"/>
                                </p:selectOneMenu>
                            </p:panelGrid>
                            
                        </p:panelGrid>

                        <p:panelGrid columns="1">    

    <!--                            <p:galleria value="#//{mbDigitacaoPlacas.images}" var="image" panelWidth="800" panelHeight="600" showCaption="false">
                                    <p:graphicImage name="/temp/#//{image}" alt="Imagem de infração #//{image}" title="#//{image}"/> 
                                </p:galleria> 
    -->
    
    <!--                        <p:imageSwitch effect="wipe" widgetVar="switcher" id="manuelSwitcher" slideshowAuto="false">
                                <ui:repeat value="#//{mbDigitacaoPlacas.images}" var="image" id="manuelSwitcherImages" >
                                    <p:graphicImage value="#//{image}" id="image" height="600" width="800"/>
                                </ui:repeat>
                            </p:imageSwitch>
    -->                        

                            <p:graphicImage value="#{mbDigitacaoPlacas.imagemInfracao}" id="imagemInfracao" cache="false" height="600" width="800"/>
    
                            <p:toolbar>
                                <p:toolbarGroup>
                                    <p:commandButton  icon="ui-icon-circle-triangle-w" id="imagem_anterior" actionListener="#{mbDigitacaoPlacas.navegaImagem('ANTERIOR')}" process="@this" update=":imagemInfracao" style="width: 100px"/>
                                    <p:commandButton  icon="ui-icon-circle-triangle-e" id="imagem_proximo" actionListener="#{mbDigitacaoPlacas.navegaImagem('PROXIMO')}" process="@this" update=":imagemInfracao" style="width: 100px"/>
                                </p:toolbarGroup>
                            </p:toolbar>
    
                            <p:toolbar>
                                <p:toolbarGroup>
                                    <p:commandButton value="Proximo" icon="ui-icon-arrow-1-e" action="#{mbDigitacaoPlacas.proximoRegistro()}" update="@form" style="width: 100px"> 
<!--                                        <f:actionListener binding="#\\{mbDigitacaoPlacas.proximoRegistro()}"/> -->
                                        <p:ajax event="click" oncomplete="document.getElementById('dc_placa').focus()"/>     
                                    </p:commandButton>

                                    <p:commandButton value="Obliterar" icon="ui-icon-circle-close" onclick="PF('dial_obliteraImagem').show();" style="width: 100px" update="imageCropper mensagemObliteracao imagemObliteracao">
                                        <f:actionListener binding="#{mbDigitacaoPlacas.iniciaObliteracao()}"/>
                                    </p:commandButton>     
                                    <p:commandButton value="Zoom" icon="ui-icon-zoomin" onclick="PF('dial_ZoomImagem').show();" style="width: 100px"/>
                                    <p:commandButton value="Vídeo" icon="ui-icon-video" style="width: 100px"/>
                                    <p:commandButton value="Consulta Placa" icon="ui-icon-search" style="width: 150px"/>
                                    <p:commandButton value="Imprimir" icon="ui-icon-print" style="width: 100px"/>
                                </p:toolbarGroup>
                            </p:toolbar>
                        </p:panelGrid>
                    </p:panelGrid>     
                </div>
                <br/>
                
                
                <p:dialog header="Obliteração de Imagem" id="dialogObliteracao" widgetVar="dial_obliteraImagem" modal="true" height="750" width="790">
                    <h:outputText value="Imagem:" />
                    
                        <p:growl id="msg1" showDetail="true" />
                        <h:panelGrid columns="1" id="panelImagemObliterar" style="height: 550px">
                            <p:imageCropper value="#{mbDigitacaoPlacas.croppedImage}" image="#{mbDigitacaoPlacas.imagemObliteracao}" initialCoords="100,50,300,100" id="imageCropper" />  

<!--                            <p:imageCropper immediate="true" value="#//{mbDigitacaoPlacas.croppedImage}" image="/resources/upload/000010102488718260_00.jpg" initialCoords="225,75,300,125" id="imageCropper"/> -->
                        </h:panelGrid>    
                        <p:panelGrid columns="2" id="panelDescricaoImagem">
                            <p:outputLabel for="imagemObliteracao" value="Imagem: "/>
                            <p:inputText id="imagemObliteracao" value="#{mbDigitacaoPlacas.imagemObliteracao}" size="86" disabled="true"/>
                            <p:outputLabel for="mensagemObliteracao" value="Mensagem: "/>    
                            <p:inputText id="mensagemObliteracao" value="#{mbDigitacaoPlacas.mensagemObliteracao}" size="86" style="background-color:#ddd;color:#00f;" readonly="true" />
                        </p:panelGrid>
                    
                    
                    <p:toolbar>
                        <p:toolbarGroup align="center">
                                <div align="center">
                                <p:commandButton value="Limpar" actionListener="#{mbDigitacaoPlacas.limpaObliteracao()}" update="imageCropper mensagemObliteracao imagemObliteracao msg1" icon="ui-icon-cancel" style="width: 100px"/>
                                <p:commandButton value="Obliterar" actionListener="#{mbDigitacaoPlacas.crop()}" update="imageCropper imagemObliteracao mensagemObliteracao msg1" icon="ui-icon-tag" style="width: 100px"/>
                                <p:commandButton value="Finalizar" actionListener="#{mbDigitacaoPlacas.finalizaObliteracao()}" update="imageCropper imagemObliteracao mensagemObliteracao msg1" icon="ui-icon-image" style="width: 100px"/>
                                <p:commandButton value="Voltar" actionListener="#{mbDigitacaoPlacas.voltarObliteracao()}" onclick="PF('dial_obliteraImagem').hide();" update="imagemInfracao mensagemObliteracao msg1" icon="ui-icon-arrowreturnthick-1-s" style="width: 100px"/>
                                </div>    
                        </p:toolbarGroup>
                    </p:toolbar>
                </p:dialog>   

                <p:dialog header="Zoom da Imagem" id="dialogZoomImagem" widgetVar="dial_ZoomImagem" modal="true" height="750" width="790">
                    <h:outputText value="Imagem:" />
                    
                        <p:growl id="msg2" showDetail="true" />
                        <h:panelGrid columns="1" id="panelZoomImagem" style="height: 550px">
                            <img id="zoom_lente" src="/samtWebAlpha/resources/upload/image_teste.jpg" data-zoom-image="/samtWebAlpha/resources/upload/image_lente.jpg"/>  
                        </h:panelGrid>    
                        <p:panelGrid columns="2" id="panelDescricaoZoomImagem">
                            <p:outputLabel for="imagemZoom" value="Imagem: "/>
                            <p:inputText id="imagemZoom" value="#{mbDigitacaoPlacas.imagemInfracao}" size="86" disabled="true"/>
                        </p:panelGrid>
                    
                    <p:toolbar>
                        <p:toolbarGroup align="center">
                                <div align="center">
                                <p:commandButton value="Voltar"  onclick="PF('dial_ZoomImagem').hide();" update="imagemInfracao msg2" icon="ui-icon-arrowreturnthick-1-s" style="width: 100px"/>
                                </div>    
                        </p:toolbarGroup>
                    </p:toolbar>
                </p:dialog>   


            </h:form>

        </p:fieldset>


    </ui:define>
</ui:composition>
